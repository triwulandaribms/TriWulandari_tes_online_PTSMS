<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel (AJAX + JWT)</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f7f7f7; }
    h2, h3 { color: #333; }
    input, button { padding: 8px; margin: 4px; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #eee; }
    .box { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
  </style>
</head>
<body>

  <h2>Admin Panel AJAX + JWT</h2>

  <div class="box">
    <h3>Registrasi Admin</h3>
    <input type="text" id="reg_name" placeholder="Nama">
    <input type="email" id="reg_email" placeholder="Email">
    <input type="password" id="reg_password" placeholder="Password">
    <button onclick="registerAdmin()">Register</button>
  </div>

 
  <div class="box">
    <h3>Login Admin</h3>
    <input type="email" id="login_email" placeholder="Email">
    <input type="password" id="login_password" placeholder="Password">
    <button onclick="loginAdmin()"> Login</button>
  </div>

  <div class="box">
    <h3>Tambah Seller / Buyer</h3>
    <input type="text" id="user_name" placeholder="Nama">
    <input type="email" id="user_email" placeholder="Email">
    <input type="password" id="user_password" placeholder="Password">
    <select id="user_role">
      <option value="seller">Seller</option>
      <option value="buyer">Buyer</option>
    </select>
    <button onclick="registerUser()">Tambah User</button>
  </div>

  <div class="box">
    <h3>Daftar User</h3>
    <button onclick="loadUsers()">Refresh</button>
    <table id="userTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nama</th>
          <th>Email</th>
          <th>Role</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const BASE_URL = "http://127.0.0.1:8000/api";
    let token = "";

    function registerAdmin() {
      $.post(`${BASE_URL}/admin/registrasi`, {
        name: $("#reg_name").val(),
        email: $("#reg_email").val(),
        password: $("#reg_password").val()
      })
      .done(res => alert("Admin berhasil registrasi!"))
      .fail(err => alert("Gagal registrasi admin!"));
    }

    function loginAdmin() {
      $.post(`${BASE_URL}/admin/login`, {
        email: $("#login_email").val(),
        password: $("#login_password").val()
      })
      .done(res => {
        token = res.token;
        localStorage.setItem("jwt_token", token);
        alert("Login sukses!");
      })
      .fail(() => alert("Login gagal!"));
    }

    function registerUser() {
      const role = $("#user_role").val();
      const endpoint = role === "seller" ? "registrasi-seller" : "registrasi-buyer";
      const jwt = localStorage.getItem("jwt_token");

      $.ajax({
        url: `${BASE_URL}/admin/${endpoint}`,
        type: "POST",
        headers: { Authorization: "Bearer " + jwt },
        data: {
          name: $("#user_name").val(),
          email: $("#user_email").val(),
          password: $("#user_password").val(),
          role: role
        },
        success: res => {
          alert(`${role} berhasil ditambahkan!`);
          loadUsers();
        },
        error: err => {
          alert("Gagal menambahkan user!");
          console.error(err);
        }
      });
    }

    function loadUsers() {
      const jwt = localStorage.getItem("jwt_token");

      $.ajax({
        url: `${BASE_URL}/admin/list-user`,
        type: "GET",
        headers: { Authorization: "Bearer " + jwt },
        success: data => {
          const tbody = $("#userTable tbody");
          tbody.empty();
          data.forEach(u => {
            tbody.append(`
              <tr>
                <td>${u.id}</td>
                <td>${u.name}</td>
                <td>${u.email}</td>
                <td>${u.role}</td>
              </tr>
            `);
          });
        },
        error: err => {
          alert("Gagal mengambil data user!");
        }
      });
    }

     $(document).ready(() => {
      const savedToken = localStorage.getItem("jwt_token");
      if (savedToken) {
        token = savedToken;
        loadUsers();
      }
    });
  </script>

</body>
</html>
